import{a as e,g as a,n as s,s as t,b as n,c as l,r as o,d as u,w as c,S as d,o as i,e as m,f as r,h,F as g,i as f,j as p,t as _,k as b,l as I,m as k,I as C,p as y,q as U,u as w,v as E,x as S}from"./index-D_d2O-Hh.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";const v=M({data:()=>({gameMode:"classic",showSettings:!1,soundEnabled:!0,musicEnabled:!0,musicVolume:50,soundVolume:50,themes:["chiikawa默认主题","零食主题","自嘲熊主题","chiikawa海滩主题","水果主题"],themeIndex:0,currentTheme:"animal",userInfo:{username:"",encryptedData:""},usernameInput:"",newUsernameInput:"",usernameLoading:!1,showChangeUsernameModal:!1,floatingImages:[]}),computed:{canSubmitUsername(){return this.usernameInput.length>=2&&this.usernameInput.length<=12&&!this.usernameLoading&&/^[\u4e00-\u9fa5a-zA-Z0-9_]+$/.test(this.usernameInput)},canSubmitNewUsername(){return this.newUsernameInput.length>=2&&this.newUsernameInput.length<=12&&!this.usernameLoading&&this.newUsernameInput!==this.userInfo.username&&/^[\u4e00-\u9fa5a-zA-Z0-9_]+$/.test(this.newUsernameInput)}},onLoad(){this.loadSettings(),this.loadUserInfo(),this.initFloatingImages()},onShow(){e.resumeBackgroundMusic()},methods:{selectMode(a){e.playSound("click"),this.gameMode=a},startGame(){e.playSound("click"),e.resumeBackgroundMusic(),a().globalData={gameMode:this.gameMode,soundEnabled:this.soundEnabled,musicEnabled:this.musicEnabled,currentTheme:this.currentTheme,themeIndex:this.themeIndex},s({url:"/pages/game/game"})},goToLeaderboard(){e.resumeBackgroundMusic(),this.soundEnabled&&e.playSound("click"),a().globalData={soundEnabled:this.soundEnabled,musicEnabled:this.musicEnabled},s({url:"/pages/leaderboard/leaderboard"})},toggleSettings(){e.playSound("click"),this.showSettings=!this.showSettings,e.resumeBackgroundMusic()},toggleSound(a){e.playSound("click"),this.soundEnabled=a.detail.value,e.setSoundEnabled(this.soundEnabled)},toggleMusic(a){e.playSound("click"),e.resumeBackgroundMusic(),this.musicEnabled=a.detail.value,e.setMusicEnabled(this.musicEnabled)},onSoundVolumeChange(a){this.soundVolume=a.detail.value;const s=this.soundVolume/100;e.setSoundVolume(s),e.playSound("click")},onMusicVolumeChange(a){this.musicVolume=a.detail.value;const s=this.musicVolume/100;e.setMusicVolume(s)},selectTheme(a){e.playSound("click"),this.themeIndex=a;this.currentTheme=["animal","candy","gem","ocean","fruit"][this.themeIndex],t("currentTheme",this.currentTheme),t("themeIndex",this.themeIndex)},loadSettings(){const a=e.getSettings();this.soundEnabled=a.soundEnabled,this.musicEnabled=a.musicEnabled,this.musicVolume=Math.round(100*a.musicVolume),this.soundVolume=Math.round(100*a.soundVolume);const s=n("currentTheme")||"animal",t=n("themeIndex")||0;this.themeIndex=t,this.currentTheme=s},loadUserInfo(){const e=n("userInfo");e&&e.username&&e.encryptedData&&(this.userInfo=e)},saveUserInfo(){t("userInfo",this.userInfo)},onUsernameInput(e){this.usernameInput=e.detail.value.trim()},onNewUsernameInput(e){this.newUsernameInput=e.detail.value.trim()},async submitUsername(){if(this.canSubmitUsername){e.playSound("click"),this.usernameLoading=!0;try{const e=await this.registerUsername(this.usernameInput);e.success?(this.userInfo={username:e.data.username,encryptedData:e.data.encryptedData},this.saveUserInfo(),this.usernameInput="",l({title:"昵称设置成功！",icon:"success",duration:2e3})):l({title:e.message||"昵称设置失败",icon:"none",duration:3e3})}catch(a){console.error("提交用户名失败:",a),l({title:a.message||"网络连接失败，请检查网络设置",icon:"none",duration:3e3})}finally{this.usernameLoading=!1}}},showChangeUsernameDialog(){e.playSound("click"),this.newUsernameInput="",this.showChangeUsernameModal=!0},cancelChangeUsername(){e.playSound("click"),this.showChangeUsernameModal=!1,this.newUsernameInput=""},async confirmChangeUsername(){if(this.canSubmitNewUsername){e.playSound("click"),this.usernameLoading=!0;try{const e=await this.updateUsername(this.userInfo.username,this.userInfo.encryptedData,this.newUsernameInput);e.success?(this.userInfo={username:e.data.username,encryptedData:e.data.encryptedData},this.saveUserInfo(),this.showChangeUsernameModal=!1,this.newUsernameInput="",l({title:`昵称更换成功！已更新${e.data.updatedRecords}条游戏记录`,icon:"success",duration:3e3})):l({title:e.message||"昵称更换失败",icon:"none",duration:3e3})}catch(a){console.error("更换用户名失败:",a),l({title:a.message||"网络连接失败，请检查网络设置",icon:"none",duration:3e3})}finally{this.usernameLoading=!1}}},async registerUsername(e){const a=this.$apiConfig;if(!a)throw new Error("API配置未找到");const s=a.BASE_URL+a.ENDPOINTS.REGISTER_USERNAME;return new Promise(((a,t)=>{o({url:s,method:"POST",header:{"Content-Type":"application/json"},data:{username:e},success:e=>{var s,t,n;200===e.statusCode?a(e.data):409===e.statusCode?a({success:!1,message:(null==(s=e.data)?void 0:s.message)||"该昵称已被使用，请选择其他昵称"}):400===e.statusCode?a({success:!1,message:(null==(t=e.data)?void 0:t.message)||"用户名格式不正确"}):a({success:!1,message:(null==(n=e.data)?void 0:n.message)||`服务器错误 (${e.statusCode})`})},fail:e=>{console.error("网络请求失败:",e),t(new Error("网络连接失败，请检查网络设置"))}})}))},async updateUsername(e,a,s){const t=this.$apiConfig;if(!t)throw new Error("API配置未找到");const n=t.BASE_URL+t.ENDPOINTS.UPDATE_USERNAME;return new Promise(((t,l)=>{o({url:n,method:"POST",header:{"Content-Type":"application/json"},data:{oldUsername:e,oldEncryptedData:a,newUsername:s},success:e=>{var a,s,n,l;200===e.statusCode?t(e.data):401===e.statusCode?t({success:!1,message:(null==(a=e.data)?void 0:a.message)||"用户身份验证失败，无法修改用户名"}):409===e.statusCode?t({success:!1,message:(null==(s=e.data)?void 0:s.message)||"该昵称已被使用，请选择其他昵称"}):400===e.statusCode?t({success:!1,message:(null==(n=e.data)?void 0:n.message)||"参数错误"}):t({success:!1,message:(null==(l=e.data)?void 0:l.message)||`服务器错误 (${e.statusCode})`})},fail:e=>{console.error("网络请求失败:",e),l(new Error("网络连接失败，请检查网络设置"))}})}))},initFloatingImages(){const e=["1.png","2.png","3.png","4.png","5.png","6.png","7.png"],a=12+Math.floor(7*Math.random());for(let s=0;s<a;s++){const a=e[Math.floor(Math.random()*e.length)],t=["float1","float2","float3","float4","float5","float6","spiral","wave"],n=t[s%t.length];this.floatingImages.push({id:s,src:`/static/wallpaper/index/${a}`,x:0,y:0,size:80+80*Math.random(),opacity:.2+.15*Math.random(),delay:10*Math.random(),duration:18+12*Math.random(),animationType:n})}}}},[["render",function(e,a,s,t,n,l){const o=S,M=I,v=k,x=C,V=y,T=U,F=w,D=d;return i(),u(D,{"scroll-y":"true",class:"scroll-container"},{default:c((()=>[m(M,{class:"home-container"},{default:c((()=>[m(M,{class:"floating-images-container"},{default:c((()=>[(i(!0),r(g,null,h(n.floatingImages,(e=>(i(),u(o,{key:e.id,src:e.src,class:"floating-image",style:E({width:e.size+"rpx",height:e.size+"rpx",animationDuration:e.duration+"s",animationDelay:e.delay+"s"}),mode:"aspectFit"},null,8,["src","style"])))),128))])),_:1}),m(M,{class:"title-container"},{default:c((()=>[m(v,{class:"game-title"},{default:c((()=>[f("🌟 sueii消消乐 🌟")])),_:1}),m(v,{class:"game-subtitle"},{default:c((()=>[f("点击相邻方块交换消除")])),_:1})])),_:1}),m(M,{class:"username-section"},{default:c((()=>[n.userInfo.username?(i(),u(M,{key:1,class:"username-display"},{default:c((()=>[m(M,{class:"welcome-card"},{default:c((()=>[m(M,{class:"welcome-info"},{default:c((()=>[m(v,{class:"welcome-icon"},{default:c((()=>[f("🎮")])),_:1}),m(v,{class:"welcome-text"},{default:c((()=>[f("欢迎回来，"+_(n.userInfo.username)+"！",1)])),_:1})])),_:1}),m(V,{class:"change-username-btn",onClick:l.showChangeUsernameDialog},{default:c((()=>[m(M,{class:"change-btn-content"},{default:c((()=>[m(v,{class:"change-icon"},{default:c((()=>[f("✏️")])),_:1}),m(v,{class:"change-text"},{default:c((()=>[f("更换")])),_:1})])),_:1}),m(M,{class:"change-btn-ripple"})])),_:1},8,["onClick"])])),_:1})])),_:1})):(i(),u(M,{key:0,class:"username-setup"},{default:c((()=>[m(M,{class:"username-prompt"},{default:c((()=>[m(v,{class:"prompt-icon"},{default:c((()=>[f("👤")])),_:1}),m(v,{class:"prompt-text"},{default:c((()=>[f("设置你的游戏昵称")])),_:1})])),_:1}),m(M,{class:"username-input-container"},{default:c((()=>[m(x,{class:"username-input",modelValue:n.usernameInput,"onUpdate:modelValue":a[0]||(a[0]=e=>n.usernameInput=e),placeholder:"请输入昵称（2-12个字符）",maxlength:"12",onInput:l.onUsernameInput},null,8,["modelValue","onInput"])])),_:1}),m(M,{class:"username-submit-container"},{default:c((()=>[m(V,{class:p(["username-submit-btn",{disabled:!l.canSubmitUsername,loading:n.usernameLoading}]),disabled:!l.canSubmitUsername,onClick:l.submitUsername},{default:c((()=>[m(M,{class:"submit-btn-content"},{default:c((()=>[n.usernameLoading?(i(),u(v,{key:0,class:"loading-icon"},{default:c((()=>[f("⏳")])),_:1})):(i(),u(v,{key:1,class:"submit-icon"},{default:c((()=>[f("✨")])),_:1})),m(v,{class:"submit-text"},{default:c((()=>[f(_(n.usernameLoading?"验证中...":"设置昵称"),1)])),_:1})])),_:1}),m(M,{class:"submit-btn-shine"})])),_:1},8,["class","disabled","onClick"])])),_:1}),m(M,{class:"username-tips"},{default:c((()=>[m(v,{class:"tip-text"},{default:c((()=>[f("💡 昵称将用于游戏记录和排行榜")])),_:1})])),_:1})])),_:1}))])),_:1}),m(M,{class:"mode-selection"},{default:c((()=>[m(v,{class:"mode-title"},{default:c((()=>[f("选择游戏模式")])),_:1}),m(M,{class:"mode-container"},{default:c((()=>[m(M,{class:p(["mode-card",{"mode-active":"classic"===n.gameMode}]),onClick:a[1]||(a[1]=e=>l.selectMode("classic"))},{default:c((()=>[m(M,{class:"mode-icon-wrapper"},{default:c((()=>[m(v,{class:"mode-icon"},{default:c((()=>[f("🎯")])),_:1})])),_:1}),m(M,{class:"mode-content"},{default:c((()=>[m(v,{class:"mode-name"},{default:c((()=>[f("经典模式")])),_:1}),m(v,{class:"mode-desc"},{default:c((()=>[f("自由消除，挑战高分")])),_:1})])),_:1}),"classic"===n.gameMode?(i(),u(M,{key:0,class:"mode-badge"},{default:c((()=>[m(v,{class:"badge-text"},{default:c((()=>[f("已选择")])),_:1})])),_:1})):b("",!0)])),_:1},8,["class"]),m(M,{class:p(["mode-card",{"mode-active":"timed"===n.gameMode}]),onClick:a[2]||(a[2]=e=>l.selectMode("timed"))},{default:c((()=>[m(M,{class:"mode-icon-wrapper"},{default:c((()=>[m(v,{class:"mode-icon"},{default:c((()=>[f("⏰")])),_:1})])),_:1}),m(M,{class:"mode-content"},{default:c((()=>[m(v,{class:"mode-name"},{default:c((()=>[f("限时模式")])),_:1}),m(v,{class:"mode-desc"},{default:c((()=>[f("争分夺秒，快速反应")])),_:1})])),_:1}),"timed"===n.gameMode?(i(),u(M,{key:0,class:"mode-badge"},{default:c((()=>[m(v,{class:"badge-text"},{default:c((()=>[f("已选择")])),_:1})])),_:1})):b("",!0)])),_:1},8,["class"]),m(M,{class:p(["mode-card",{"mode-active":"chaos"===n.gameMode}]),onClick:a[3]||(a[3]=e=>l.selectMode("chaos"))},{default:c((()=>[m(M,{class:"mode-icon-wrapper"},{default:c((()=>[m(v,{class:"mode-icon"},{default:c((()=>[f("🌪️ ")])),_:1})])),_:1}),m(M,{class:"mode-content"},{default:c((()=>[m(v,{class:"mode-name"},{default:c((()=>[f("混沌模式")])),_:1}),m(v,{class:"mode-desc"},{default:c((()=>[f("随机挑战，变化无穷")])),_:1})])),_:1}),"chaos"===n.gameMode?(i(),u(M,{key:0,class:"mode-badge"},{default:c((()=>[m(v,{class:"badge-text"},{default:c((()=>[f("已选择")])),_:1})])),_:1})):b("",!0)])),_:1},8,["class"])])),_:1})])),_:1}),m(V,{class:"start-btn",onClick:l.startGame},{default:c((()=>[m(v,{class:"start-text"},{default:c((()=>[f("🎮开始游戏")])),_:1})])),_:1},8,["onClick"]),m(V,{class:"leaderboard-btn",onClick:l.goToLeaderboard},{default:c((()=>[m(v,{class:"leaderboard-text"},{default:c((()=>[f("🏆排行榜")])),_:1})])),_:1},8,["onClick"]),m(M,{class:"settings-container"},{default:c((()=>[m(V,{class:"settings-btn",onClick:l.toggleSettings},{default:c((()=>[m(v,{class:"settings-icon"},{default:c((()=>[f("⚙️")])),_:1})])),_:1},8,["onClick"])])),_:1}),n.showSettings?(i(),u(M,{key:0,class:"settings-panel"},{default:c((()=>[m(M,{class:"settings-content"},{default:c((()=>[m(v,{class:"settings-title"},{default:c((()=>[f("游戏设置")])),_:1}),m(M,{class:"setting-item"},{default:c((()=>[m(v,{class:"setting-label"},{default:c((()=>[f("音效")])),_:1}),m(T,{checked:n.soundEnabled,onChange:l.toggleSound},null,8,["checked","onChange"])])),_:1}),n.soundEnabled?(i(),u(M,{key:0,class:"setting-item volume-setting"},{default:c((()=>[m(v,{class:"setting-label"},{default:c((()=>[f("音效音量")])),_:1}),m(M,{class:"volume-control"},{default:c((()=>[m(v,{class:"volume-text"},{default:c((()=>[f(_(n.soundVolume)+"%",1)])),_:1}),m(F,{value:n.soundVolume,onChange:l.onSoundVolumeChange,min:"0",max:"100",step:"5",activeColor:"#FF6B9D",backgroundColor:"#E0E0E0","block-color":"#FFFFFF","block-size":"24",class:"volume-slider"},null,8,["value","onChange"])])),_:1})])),_:1})):b("",!0),m(M,{class:"setting-item"},{default:c((()=>[m(v,{class:"setting-label"},{default:c((()=>[f("背景音乐")])),_:1}),m(T,{checked:n.musicEnabled,onChange:l.toggleMusic},null,8,["checked","onChange"])])),_:1}),n.musicEnabled?(i(),u(M,{key:1,class:"setting-item volume-setting"},{default:c((()=>[m(v,{class:"setting-label"},{default:c((()=>[f("音乐音量")])),_:1}),m(M,{class:"volume-control"},{default:c((()=>[m(v,{class:"volume-text"},{default:c((()=>[f(_(n.musicVolume)+"%",1)])),_:1}),m(F,{value:n.musicVolume,onChange:l.onMusicVolumeChange,min:"0",max:"100",step:"5",activeColor:"#FF6B9D",backgroundColor:"#E0E0E0","block-color":"#FFFFFF","block-size":"24",class:"volume-slider"},null,8,["value","onChange"])])),_:1})])),_:1})):b("",!0),m(M,{class:"setting-item theme-setting"},{default:c((()=>[m(v,{class:"setting-label"},{default:c((()=>[f("主题")])),_:1}),m(M,{class:"theme-selector"},{default:c((()=>[(i(!0),r(g,null,h(n.themes,((e,a)=>(i(),u(M,{key:a,class:p(["theme-option",{"theme-active":n.themeIndex===a}]),onClick:e=>l.selectTheme(a)},{default:c((()=>[m(v,{class:"theme-name"},{default:c((()=>[f(_(e),1)])),_:2},1024),n.themeIndex===a?(i(),u(v,{key:0,class:"theme-check"},{default:c((()=>[f("✓")])),_:1})):b("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),m(V,{class:"close-settings-btn",onClick:l.toggleSettings},{default:c((()=>[m(v,{class:"close-text"},{default:c((()=>[f("关闭")])),_:1})])),_:1},8,["onClick"])])),_:1})])),_:1})):b("",!0),n.showChangeUsernameModal?(i(),u(M,{key:1,class:"settings-panel"},{default:c((()=>[m(M,{class:"settings-content change-username-modal"},{default:c((()=>[m(v,{class:"settings-title"},{default:c((()=>[f("更换昵称")])),_:1}),m(M,{class:"current-username"},{default:c((()=>[m(v,{class:"current-label"},{default:c((()=>[f("当前昵称：")])),_:1}),m(v,{class:"current-name"},{default:c((()=>[f(_(n.userInfo.username),1)])),_:1})])),_:1}),m(M,{class:"username-input-container"},{default:c((()=>[m(x,{class:"username-input",modelValue:n.newUsernameInput,"onUpdate:modelValue":a[4]||(a[4]=e=>n.newUsernameInput=e),placeholder:"请输入新昵称（2-12个字符）",maxlength:"12",onInput:l.onNewUsernameInput},null,8,["modelValue","onInput"])])),_:1}),m(M,{class:"modal-buttons"},{default:c((()=>[m(V,{class:"cancel-btn",onClick:l.cancelChangeUsername},{default:c((()=>[m(v,{class:"cancel-text"},{default:c((()=>[f("取消")])),_:1})])),_:1},8,["onClick"]),m(V,{class:p(["modal-confirm-btn",{disabled:!l.canSubmitNewUsername,loading:n.usernameLoading}]),disabled:!l.canSubmitNewUsername,onClick:l.confirmChangeUsername},{default:c((()=>[m(M,{class:"modal-btn-content"},{default:c((()=>[n.usernameLoading?(i(),u(v,{key:0,class:"loading-icon"},{default:c((()=>[f("⏳")])),_:1})):(i(),u(v,{key:1,class:"submit-icon"},{default:c((()=>[f("✨")])),_:1})),m(v,{class:"modal-confirm-text"},{default:c((()=>[f(_(n.usernameLoading?"验证中...":"确认更换"),1)])),_:1})])),_:1}),m(M,{class:"modal-btn-shine"})])),_:1},8,["class","disabled","onClick"])])),_:1})])),_:1})])),_:1})):b("",!0)])),_:1})])),_:1})}],["__scopeId","data-v-3da03b17"]]);export{v as default};
