import{E as e,c as a,G as s,a as t,g as r,r as l,b as n,d as o,w as c,l as i,o as d,e as u,f,h,F as g,i as m,t as _,k as y,j as k,m as p,p as P,v as b,x as I}from"./index-LxKnEaWO.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const w=x({data:()=>({floatingImages:[],soundEnabled:!0,musicEnabled:!0,gameModes:[{key:"classic",name:"经典模式",icon:"🎯"},{key:"timed",name:"限时模式",icon:"⚡"},{key:"chaos",name:"混沌模式",icon:"🌪️"}],regions:[{key:"local",name:"当前区域",icon:"📍"},{key:"national",name:"全国",icon:"🇨🇳"},{key:"global",name:"全球",icon:"🌍"}],currentModeIndex:0,currentRegionIndex:0,loading:!1,leaderboardData:[],currentUserRank:null,userLocation:"",userIP:""}),computed:{currentMode(){return this.gameModes[this.currentModeIndex]},currentRegion(){return this.regions[this.currentRegionIndex]},topThreePlayers(){return this.leaderboardData.slice(0,3)},otherPlayers(){return this.leaderboardData.slice(3)}},async onLoad(){this.initFloatingImages(),this.loadGameSettings(),this.currentModeIndex=0,this.currentRegionIndex=0,e({title:"正在加载排行榜...",mask:!0});try{await this.getUserIP(),await this.loadLeaderboard(),a({title:"排行榜加载完成",icon:"success",duration:1500})}catch(t){console.error("预加载失败:",t),a({title:"加载失败，请刷新重试",icon:"none",duration:2e3})}finally{s()}},onShow(){t.resumeBackgroundMusic()},methods:{initFloatingImages(){const e=["1.png","2.png","3.png","4.png","5.png","6.png","7.png"],a=12+Math.floor(7*Math.random());for(let s=0;s<a;s++){const a=e[Math.floor(Math.random()*e.length)],t=["float1","float2","float3","float4","float5","float6","spiral","wave"],r=t[s%t.length];this.floatingImages.push({id:s,src:`/static/wallpaper/index/${a}`,size:80+80*Math.random(),delay:10*Math.random(),duration:18+12*Math.random(),animationType:r})}},loadGameSettings(){const e=r().globalData||{};console.log(e),this.soundEnabled=!1!==e.soundEnabled,this.musicEnabled=!1!==e.musicEnabled},async getUserIP(){try{const a=["https://httpbin.org/ip"];for(const s of a)try{const e=await this.makeIPRequest(s,3e3);if(e){let a=e.ip||e.origin||e;if("string"==typeof a&&a.match(/^\d+\.\d+\.\d+\.\d+$/))this.userIP=a;else{if("string"!=typeof e||!e.match(/^\d+\.\d+\.\d+\.\d+$/))continue;this.userIP=e}return void console.log("获取到用户IP:",this.userIP)}}catch(e){console.log(`IP服务 ${s} 失败:`,e);continue}this.userIP="127.0.0.1",console.log("使用默认IP:",this.userIP)}catch(e){console.error("获取IP地址失败:",e),this.userIP="127.0.0.1"}},makeIPRequest:(e,a=5e3)=>new Promise(((s,t)=>{l({url:e,method:"GET",timeout:a,success:e=>{200===e.statusCode?s(e.data):t(new Error(`HTTP ${e.statusCode}`))},fail:e=>{t(e)}})})),async switchMode(r){if(this.currentModeIndex!==r){t.playSound("click"),this.currentModeIndex=r,e({title:`切换到${this.gameModes[r].name}...`,mask:!1});try{await this.loadLeaderboard(),s()}catch(l){s(),a({title:"切换失败，请重试",icon:"none",duration:2e3})}}},async switchRegion(r){if(this.currentRegionIndex!==r){t.playSound("click"),this.currentRegionIndex=r,e({title:`切换到${this.regions[r].name}...`,mask:!1});try{await this.loadLeaderboard(),s()}catch(l){s(),a({title:"切换失败，请重试",icon:"none",duration:2e3})}}},async loadLeaderboard(){t.resumeBackgroundMusic(),this.loading=!0;const e=this.$apiConfig;if(!e)throw new Error("API配置未找到");try{const s=n("userInfo"),t=e.BASE_URL+e.ENDPOINTS.LEADERBOARD,r={gameMode:this.currentMode.key,regionType:this.currentRegion.key,username:(null==s?void 0:s.username)||"",userLocation:this.userLocation,userIP:this.userIP||"127.0.0.1"},l=await this.makeRequest(t,r);l.success?(this.leaderboardData=l.data.rankings||[],this.currentUserRank=l.data.currentUserRank||null):a({title:l.message||"加载失败",icon:"none",duration:2e3})}catch(s){console.error("加载排行榜失败:",s),a({title:s.message||"网络错误",icon:"none",duration:2e3})}finally{this.loading=!1}},refreshLeaderboard(){t.playSound("click"),this.loadLeaderboard()},makeRequest:(e,a)=>new Promise(((s,t)=>{l({url:e,method:"POST",header:{"Content-Type":"application/json"},data:a,success:e=>{var a;200===e.statusCode?s(e.data):s({success:!1,message:(null==(a=e.data)?void 0:a.message)||`服务器错误 (${e.statusCode})`})},fail:()=>{t(new Error("网络连接失败"))}})})),formatScore:e=>e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(1)+"K":e.toString(),getMedalIcon:e=>["🥇","🥈","🥉"][e-1]||"🏅",getRankMedal:e=>1===e?"👑":e<=3?"🏆":"🏅",getExtraInfo(e){const a=this.currentMode.key;return"classic"===a?`第${e.level_or_challenge}关`:"chaos"===a?`${e.level_or_challenge}个挑战`:""},getAvatarText(e){if(!e)return"?";const a=e.charAt(0);return/^[a-zA-Z]$/.test(a)?a.toUpperCase():a},isCurrentUser(e){const a=n("userInfo");return a&&a.username===e.username},getRankCircleClass:e=>e<=10?"rank-top-10":e<=50?"rank-top-50":e<=100?"rank-top-100":"rank-normal"}},[["render",function(e,a,s,t,r,l){const n=I,x=i,w=p,M=P;return d(),o(x,{class:"leaderboard-container"},{default:c((()=>[u(x,{class:"floating-images-container"},{default:c((()=>[(d(!0),f(g,null,h(r.floatingImages,(e=>(d(),o(n,{key:e.id,src:e.src,class:"floating-image",style:b({width:e.size+"rpx",height:e.size+"rpx",animationDuration:e.duration+"s",animationDelay:e.delay+"s"}),mode:"aspectFit"},null,8,["src","style"])))),128))])),_:1}),u(x,{class:"mode-tabs"},{default:c((()=>[(d(!0),f(g,null,h(r.gameModes,((e,a)=>(d(),o(x,{key:a,class:k(["mode-tab",{"tab-active":r.currentModeIndex===a}]),onClick:e=>l.switchMode(a)},{default:c((()=>[u(w,{class:"tab-icon"},{default:c((()=>[m(_(e.icon),1)])),_:2},1024),u(w,{class:"tab-name"},{default:c((()=>[m(_(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),u(x,{class:"region-tabs"},{default:c((()=>[(d(!0),f(g,null,h(r.regions,((e,a)=>(d(),o(x,{key:a,class:k(["region-tab",{"region-active":r.currentRegionIndex===a}]),onClick:e=>l.switchRegion(a)},{default:c((()=>[u(w,{class:"region-icon"},{default:c((()=>[m(_(e.icon),1)])),_:2},1024),u(w,{class:"region-name"},{default:c((()=>[m(_(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),r.currentUserRank?(d(),o(x,{key:0,class:"my-rank-card"},{default:c((()=>[u(x,{class:"my-rank-header"},{default:c((()=>[u(w,{class:"my-rank-title"},{default:c((()=>[m("👤 我的排名")])),_:1}),u(w,{class:"my-rank-mode"},{default:c((()=>[m(_(l.currentMode.name),1)])),_:1})])),_:1}),u(x,{class:"my-rank-content"},{default:c((()=>[u(x,{class:"my-rank-position"},{default:c((()=>[u(w,{class:"my-rank-number"},{default:c((()=>[m("第"+_(r.currentUserRank.rank)+"名",1)])),_:1}),u(w,{class:"my-rank-medal"},{default:c((()=>[m(_(l.getRankMedal(r.currentUserRank.rank)),1)])),_:1})])),_:1}),u(x,{class:"my-rank-details"},{default:c((()=>[u(w,{class:"my-rank-score"},{default:c((()=>[m(_(l.formatScore(r.currentUserRank.score))+"分",1)])),_:1}),u(w,{class:"my-rank-extra"},{default:c((()=>[m(_(l.getExtraInfo(r.currentUserRank)),1)])),_:1}),u(w,{class:"my-rank-location"},{default:c((()=>[m("📍 "+_(r.currentUserRank.location),1)])),_:1})])),_:1})])),_:1})])),_:1})):y("",!0),u(x,{class:"leaderboard-content"},{default:c((()=>[r.loading?(d(),o(x,{key:0,class:"loading-container"},{default:c((()=>[u(x,{class:"loading-spinner"},{default:c((()=>[u(w,{class:"loading-icon"},{default:c((()=>[m("⏳")])),_:1}),u(x,{class:"loading-dots"},{default:c((()=>[u(w,{class:"dot"},{default:c((()=>[m("●")])),_:1}),u(w,{class:"dot"},{default:c((()=>[m("●")])),_:1}),u(w,{class:"dot"},{default:c((()=>[m("●")])),_:1})])),_:1})])),_:1}),u(w,{class:"loading-text"},{default:c((()=>[m("加载排行榜中...")])),_:1})])),_:1})):r.leaderboardData.length>0?(d(),o(x,{key:1,class:"ranking-list"},{default:c((()=>[u(x,{class:"ranking-header"},{default:c((()=>[u(w,{class:"ranking-title"},{default:c((()=>[m("🏆 "+_(l.currentMode.name)+" - "+_(l.currentRegion.name),1)])),_:1}),u(w,{class:"ranking-subtitle"},{default:c((()=>[m("前"+_(r.leaderboardData.length)+"名玩家",1)])),_:1})])),_:1}),u(x,{class:"top-three"},{default:c((()=>[l.topThreePlayers[1]?(d(),o(x,{key:0,class:k(["top-player rank-2",{"current-user":l.isCurrentUser(l.topThreePlayers[1])}])},{default:c((()=>[u(x,{class:"rank-crown"},{default:c((()=>[u(w,{class:"crown-icon"},{default:c((()=>[m("🥈")])),_:1}),u(x,{class:"rank-badge"},{default:c((()=>[u(w,{class:"rank-text"},{default:c((()=>[m("2")])),_:1})])),_:1})])),_:1}),u(x,{class:"player-info"},{default:c((()=>[u(w,{class:k(["player-name",{"highlight-user":l.isCurrentUser(l.topThreePlayers[1])}])},{default:c((()=>[m(_(l.topThreePlayers[1].username),1)])),_:1},8,["class"]),u(x,{class:"score-container"},{default:c((()=>[u(w,{class:"player-score"},{default:c((()=>[m(_(l.formatScore(l.topThreePlayers[1].score)),1)])),_:1}),u(w,{class:"score-unit"},{default:c((()=>[m("分")])),_:1})])),_:1}),u(w,{class:"player-extra"},{default:c((()=>[m(_(l.getExtraInfo(l.topThreePlayers[1])),1)])),_:1}),u(x,{class:"location-badge"},{default:c((()=>[u(w,{class:"location-icon"},{default:c((()=>[m("📍")])),_:1}),u(w,{class:"location-text"},{default:c((()=>[m(_(l.topThreePlayers[1].location),1)])),_:1})])),_:1})])),_:1}),u(x,{class:"rank-decoration rank-2-decoration"})])),_:1},8,["class"])):y("",!0),l.topThreePlayers[0]?(d(),o(x,{key:1,class:k(["top-player rank-1",{"current-user":l.isCurrentUser(l.topThreePlayers[0])}])},{default:c((()=>[u(x,{class:"rank-crown"},{default:c((()=>[u(w,{class:"crown-icon"},{default:c((()=>[m("🥇")])),_:1}),u(x,{class:"rank-badge champion-badge"},{default:c((()=>[u(w,{class:"rank-text"},{default:c((()=>[m("1")])),_:1})])),_:1})])),_:1}),u(x,{class:"player-info"},{default:c((()=>[u(w,{class:k(["player-name champion-name",{"highlight-user":l.isCurrentUser(l.topThreePlayers[0])}])},{default:c((()=>[m(_(l.topThreePlayers[0].username),1)])),_:1},8,["class"]),u(x,{class:"score-container champion-score"},{default:c((()=>[u(w,{class:"player-score"},{default:c((()=>[m(_(l.formatScore(l.topThreePlayers[0].score)),1)])),_:1}),u(w,{class:"score-unit"},{default:c((()=>[m("分")])),_:1})])),_:1}),u(w,{class:"player-extra"},{default:c((()=>[m(_(l.getExtraInfo(l.topThreePlayers[0])),1)])),_:1}),u(x,{class:"location-badge"},{default:c((()=>[u(w,{class:"location-icon"},{default:c((()=>[m("📍")])),_:1}),u(w,{class:"location-text"},{default:c((()=>[m(_(l.topThreePlayers[0].location),1)])),_:1})])),_:1})])),_:1}),u(x,{class:"rank-decoration rank-1-decoration"}),u(x,{class:"champion-rays"})])),_:1},8,["class"])):y("",!0),l.topThreePlayers[2]?(d(),o(x,{key:2,class:k(["top-player rank-3",{"current-user":l.isCurrentUser(l.topThreePlayers[2])}])},{default:c((()=>[u(x,{class:"rank-crown"},{default:c((()=>[u(w,{class:"crown-icon"},{default:c((()=>[m("🥉")])),_:1}),u(x,{class:"rank-badge"},{default:c((()=>[u(w,{class:"rank-text"},{default:c((()=>[m("3")])),_:1})])),_:1})])),_:1}),u(x,{class:"player-info"},{default:c((()=>[u(w,{class:k(["player-name",{"highlight-user":l.isCurrentUser(l.topThreePlayers[2])}])},{default:c((()=>[m(_(l.topThreePlayers[2].username),1)])),_:1},8,["class"]),u(x,{class:"score-container"},{default:c((()=>[u(w,{class:"player-score"},{default:c((()=>[m(_(l.formatScore(l.topThreePlayers[2].score)),1)])),_:1}),u(w,{class:"score-unit"},{default:c((()=>[m("分")])),_:1})])),_:1}),u(w,{class:"player-extra"},{default:c((()=>[m(_(l.getExtraInfo(l.topThreePlayers[2])),1)])),_:1}),u(x,{class:"location-badge"},{default:c((()=>[u(w,{class:"location-icon"},{default:c((()=>[m("📍")])),_:1}),u(w,{class:"location-text"},{default:c((()=>[m(_(l.topThreePlayers[2].location),1)])),_:1})])),_:1})])),_:1}),u(x,{class:"rank-decoration rank-3-decoration"})])),_:1},8,["class"])):y("",!0)])),_:1}),u(x,{class:"other-rankings"},{default:c((()=>[u(x,{class:"rankings-header"},{default:c((()=>[u(w,{class:"rankings-title"},{default:c((()=>[m("其他排名")])),_:1})])),_:1}),(d(!0),f(g,null,h(l.otherPlayers,((e,a)=>(d(),o(x,{key:a,class:"ranking-item"},{default:c((()=>[u(x,{class:"rank-info"},{default:c((()=>[u(x,{class:k(["rank-circle",l.getRankCircleClass(e.rank)])},{default:c((()=>[u(w,{class:"rank-num"},{default:c((()=>[m(_(e.rank),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),u(x,{class:"player-details"},{default:c((()=>[u(w,{class:"player-name"},{default:c((()=>[m(_(e.username),1)])),_:2},1024),u(x,{class:"score-row"},{default:c((()=>[u(w,{class:"player-score"},{default:c((()=>[m(_(l.formatScore(e.score)),1)])),_:2},1024),u(w,{class:"score-unit-small"},{default:c((()=>[m("分")])),_:1}),u(w,{class:"player-extra"},{default:c((()=>[m(_(l.getExtraInfo(e)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),u(x,{class:"location-info"},{default:c((()=>[u(x,{class:"location-badge-small"},{default:c((()=>[u(w,{class:"location-icon-small"},{default:c((()=>[m("📍")])),_:1}),u(w,{class:"location-text"},{default:c((()=>[m(_(e.location),1)])),_:2},1024)])),_:2},1024)])),_:2},1024),u(x,{class:"ranking-item-border"})])),_:2},1024)))),128))])),_:1})])),_:1})):(d(),o(x,{key:2,class:"empty-state"},{default:c((()=>[u(x,{class:"empty-animation"},{default:c((()=>[u(w,{class:"empty-icon"},{default:c((()=>[m("📊")])),_:1}),u(x,{class:"empty-waves"},{default:c((()=>[u(x,{class:"wave wave1"}),u(x,{class:"wave wave2"}),u(x,{class:"wave wave3"})])),_:1})])),_:1}),u(w,{class:"empty-text"},{default:c((()=>[m("暂无排行榜数据")])),_:1}),u(w,{class:"empty-hint"},{default:c((()=>[m("快去游戏中创造记录吧！")])),_:1})])),_:1}))])),_:1}),u(x,{class:"refresh-container"},{default:c((()=>[u(M,{class:"refresh-btn",onClick:l.refreshLeaderboard,disabled:r.loading},{default:c((()=>[u(w,{class:k(["refresh-icon",{spinning:r.loading}])},{default:c((()=>[m("🔄")])),_:1},8,["class"]),u(w,{class:"refresh-text"},{default:c((()=>[m(_(r.loading?"刷新中...":"刷新排行榜"),1)])),_:1})])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})}],["__scopeId","data-v-3a4e316e"]]);export{w as default};
